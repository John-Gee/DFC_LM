<!-- <!doctype html> -->
<html lang="en">
    <head>
        <title> DeFiChain Liquidty Mining Calculator</title>
        <script src="jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function(){
                $("#cPriceToken").on("input", function() {
                    cPriceRatio();
                });
                $("#cPriceDFI").on("input", function() {
                    cPriceRatio();
                });

                $("#cAmountT").on("input", function() {
                    cAmountRatio();
                });
                $("#cAmountDFI").on("input", function() {
                    cAmountRatio();
                });

                $("#cPriceRatio").change(function() {
                    verifyCRatios();
                });
                $("#cAmountRatio").change(function() {
                    verifyCRatios();
                });
            });
            
            function cPriceRatio() {
                if ($("#cPriceToken").val() && $("#cPriceDFI").val()) {
                    $("#cPriceRatio").val($("#cPriceToken").val() / $("#cPriceDFI").val()).change();
                } else {
                    $("#cPriceRatio").val("").change();
                }
            }
            
            function cAmountRatio() {
                if ($("#cAmountT").val() && $("#cAmountDFI").val()) {
                    $("#cAmountRatio").val($("#cAmountDFI").val() / $("#cAmountT").val()).change();
                } else {
                    $("#cAmountRatio").val("").change();
                }
            }
            
            function verifyCRatios() {
                if ( $("#cPriceRatio").val() && $("#cAmountRatio").val() && ($("#cPriceRatio").val() != $("#cAmountRatio").val())) {
                    $("#cPriceRatio").css("background-color", "red");
                    $("#cAmountRatio").css("background-color", "red");
                } else {
                    $("#cPriceRatio").css("background-color", "white");
                    $("#cAmountRatio").css("background-color", "white");
                }
            }
            
            function isInBetween(min, max, value){
                return value >= min && value <= max;
            }
            $(document).ready(function(){
                // Get value on button click and show alert
                $("#myBtn").click(function(){
                    /*var cPriceToken = $("#cPriceToken").val();
                    var cPriceDFI    = $("#cPriceDFI").val();
                    var cPriceRatio  = cPriceToken / cPriceDFI;*/
                    var ePriceToken  = $("#ePriceToken").val() * 1;
                    var ePriceDFI    = $("#ePriceDFI").val()  * 1;
                    var ePriceRatio  = ePriceToken / ePriceDFI;
                    
                    var cAmountT     = $("#cAmountT").val()  * 1;
                    var cAmountDFI   = $("#cAmountDFI").val()  * 1;
                    var cAmountRatio = cAmountDFI/ cAmountT;
                    var fAmountT     = cAmountT;
                    var fAmountDFI   = cAmountDFI;
                    var precision    = 0.01;

                    while ((fAmountT !=0) && (fAmountDFI != 0)) {
                        var fAmountRatio = fAmountDFI / fAmountT;
                        if (isInBetween(precision * -1, precision, fAmountRatio - ePriceRatio)) {
                            break;
                        } else if (fAmountRatio < ePriceRatio) {
                           fAmountT   = fAmountT - 1;
                           fAmountDFI = fAmountDFI + (fAmountRatio);
                        } else {
                            fAmountDFI = fAmountDFI - 1;
                            fAmountT   = fAmountT + (1/fAmountRatio);
                        }
                    }
                    $("#fAmountT").val(fAmountT);
                    $("#fAmountDFI").val(fAmountDFI);
                    $("#ePriceRatio").val(ePriceRatio);
                    $("#fAmountRatio").val(fAmountRatio);
                });
            });
        </script>
        <style>
            body {
                //background-color: rgba(0, 0, 0, 0.5);
            }
            h1 {
                color: rgba(255,105,180, 1);
            }
            div {
                margin-bottom: 10px;
            }
            label {
                display: inline-block;
                width: 30%;
                text-align: left;
            }
        </style>
    </head>
    <body>
        <h1> Liquidity Mining Calculator </h1>
        <br/>
        <p>
            <div>
                <label for="cPriceToken">Current Price of the token in USD</label>
                <input type="number" id="cPriceToken" name="cPriceToken">
                <label for="cPriceRatio">Current Price Ratio</label>
                <input type="number" id="cPriceRatio" name="cPriceRatio" disabled>
            </div>
            <div>
                <label for="cPriceDFI">Current Price of DFI in USD</label>
                <input type="number" id="cPriceDFI" name="cPriceDFI">
            </div>
            <div>
                <label for="cAmountT">Current amount of Tokens</label>
                <input type="number" id="cAmountT" name="cAmountT">
                <label for="cAmountRatio">Current Amount Ratio</label>
                <input type="number" id="cAmountRatio" name="cAmountRatio" disabled>
            </div>
            <div>
                <label for="cAmountDFI">Current amount of DFIs</label>
                <input type="number" id="cAmountDFI" name="cAmountDFI">
            </div>
            <button type="button" id="myBtn">Show Value</button>
            <!--
            <div>
                <label for="days">Duration of LM in days</label>
                <input type="number" id="days" name="days">
            </div>
            <div>
                <label for="APY">APY in %</label>
                <input type="number" id="APY" name="APY">
            </div>
            -->
        </p>
        <p>
            <div>
                <label for="ePriceToken">Expected Price of your token in USD</label>
                <input type="number" id="ePriceToken" name="ePriceToken">
                <label for="ePriceRatio">Expected Price Ratio</label>
                <input type="number" id="ePriceRatio" name="ePriceRatio" disabled>
            </div>
            <div>
                <label for="ePriceDFI">Expected Price of DFI in USD</label>
                <input type="number" id="ePriceDFI" name="ePriceDFI">
            </div>
            <div>
                <label for="fAmountT">Expected amount of your Token</label>
                <input type="number" id="fAmountT" name="fAmountT" disabled>
                <label for="fAmountRatio">Expected Amount Ratio</label>
                <input type="number" id="fAmountRatio" name="fAmountRatio" disabled>
            </div>
            <div>
                <label for="fAmountDFI">Expected amount of your DFI</label>
                <input type="number" id="fAmountDFI" name="fAmountDFI" disabled>
            </div>
        </p>
    </body>
</html>
